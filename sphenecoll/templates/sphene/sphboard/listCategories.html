{% extends "sphene/sphboard/base.html" %}

{% load sphboard_extras %}
{% load sph_pagination %}

{% block content %}

  <a href="../../latest/{{ category_id }}/">Latest</a> | {% sphboard_displayBreadcrumbsForCategory category %}<br/><br/>

  {% if user.is_authenticated %}
    {% if category %}
      {% if category.has_monitor %}
        {% if category.has_direct_monitor %}
          You are currently receiving email notifications on new posts. - <a href="../../togglemonitor_category/{{ category_id }}/">Stop notifications</a>
        {% else %}
          You are currently receiving email notifications on new posts because you subscribed to a parent category.
        {% endif %}
      {% else %}
        <a href="../../togglemonitor_category/{{ category_id }}/">Notify me by email on new posts.</a>
      {% endif %}
    {% else %}
      {% if group.has_monitor %}
        You are currently receiving email notifications on new posts. - <a href="../../togglemonitor_group/{{ group.id }}/">Stop notifications</a>
      {% else %}
        {% if rootCategories %}
          <a href="../../togglemonitor_group/{{ group.id }}/">Notify me by email on new posts.</a>
        {% endif %}
      {% endif %}
    {% endif %}
    <br/><br/>
  {% endif %}

  {% if rootCategories %}
  <table class="sphboard_categories">
    <tr>
      <th colspan='6'>Title</th>
      <th>Threads</th>
      <th>Posts</th>
      <th>Last Post</th>
    </tr>
    {% sphboard_displayCategories rootCategories 5 %}
  </table>
  <br/><br/>
  {% else %}
    {% if not isShowLatest %}
      {% if not category %}
        There are currently no categories. (Or you have no permission to see them.)
      {% endif %}
    {% endif %}
  {% endif %}

  {% if isShowLatest or category.canContainPosts %}
    {% block above_thread_list %}
    {% endblock %}
    {% include category.get_category_type.get_new_thread_link_template %}
    <table class="sphboard_thread_list">
      {% block thread_list_header %}
      <tr>
        <th class="sphboard_mainhead" colspan="{% if sph_settings.board_count_views %}5{% else %}4{% endif %}">Threads</th>
      </tr>
      <tr>
        <th colspan="2">Subject / Author</th>
        {% if sph_settings.board_count_views %}
          <th>Views</th>
        {% endif %}
        <th>Posts</th>
        <th>Last Post</th>
      </tr>
      {% endblock thread_list_header %}
      {% for thread in thread_list %}
        <tr>
          <td width="20px"><img src="{{ MEDIA_URL }}sphene/sphboard/icons/{% if thread.has_new_posts %}new{% endif %}folder.gif" width='16px' height='16px' title='Heat: {{ thread.heat }}' /></td>
          {% if thread.is_moved %}
            <td colspan="4"><small>Thread was moved: <a href="{{ thread.get_absolute_url }}">{{ thread.subject }}</a> into <a href="{{ thread.category.get_absolute_url }}">{{ thread.root_post.category.name }}</a>.</small></td>
          {% else %}
          <td>{% if thread.is_sticky %}<b>Sticky:</b> {% endif %}{% if thread.is_hot %}<b>Hot:</b> {% endif %}{% if thread.is_poll %}Poll: {% endif %}{% if thread.is_closed %}Locked: {% endif %}{% block thread_list_subject %}<a href="{{ thread.get_absolute_url }}">{{ thread.subject }}</a>{% endblock %}{% if thread.has_paging %} ( {% sph_pagination thread.get_page_count -1 thread.get_absolute_url %} ){% endif %}<br/><small>{% if isShowLatest %}{% sphboard_displayBreadcrumbsForCategory thread.category 1 %} - {% endif %}by {% sphboard_displayUserName thread.author %}</small></td>
          {% block thread_list_info %}
          {% if sph_settings.board_count_views %}
            <td class="sphboard_viewcount">{{ thread.view_count }}</td>
          {% endif %}
          <td class="sphboard_postcount">{{ thread.post_count }}</td>
          <td class="sphboard_latestpost">{% sphboard_latestPost thread.latest_post 0 %}</td>
          {% endblock %}
          {% endif %}
        </tr>
      {% endfor %}
      <tr>
        <td colspan="{% if sph_settings.board_count_views %}5{% else %}4{% endif %}"><span class="board_threadcount">{{ hits }} Threads in this category.</span><span class="board_pagination">{% sph_pagination pages page %}</span></td>
      </tr>
    </table>
    <br/><br/>
    {% include category.get_category_type.get_new_thread_link_template %}
    {% if user.is_authenticated and category.has_new_posts %}
      - <a href="../../catchup/{{ category.id }}/" title="Mark all Posts in this Category as read.">Catch Up</a>
    {% endif %}
  {% endif %}

  <br/><br/>

{% endblock %}
